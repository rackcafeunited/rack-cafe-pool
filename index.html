<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rack Café Utd</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase COMPAT (NO MODULES) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }

    .hidden { display: none; }

    /* LOGIN */
    #loginScreen {
      max-width: 360px;
      margin: 80px auto;
      padding: 24px;
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 12px;
    }

    #loginScreen input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 6px;
    }

    #loginScreen button {
      width: 100%;
      padding: 10px;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    /* NAV */
    nav {
      display: flex;
      gap: 8px;
      padding: 10px;
      background: #020617;
      align-items: center;
    }

    .nav-item {
      background: #1e293b;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .nav-item.active {
      background: #dc2626;
    }

    section.section {
      display: none;
      padding: 16px;
    }

    section.section.active {
      display: block;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <h2>Login</h2>

  <input id="loginEmail" type="email" placeholder="Email" />
  <input id="loginPassword" type="password" placeholder="Password" />

  <button id="loginBtn" onclick="login()">Login</button>

  <div id="loginError" style="display:none;color:#dc2626;margin-top:10px;"></div>
</div>

<!-- APP -->
<div id="appContainer" class="hidden">

  <nav>
    <button class="nav-item active" onclick="showSection('dashboard')">Home</button>
    <button class="nav-item" onclick="showSection('players')">Squad</button>
    <button id="adminTab" class="nav-item hidden" onclick="showSection('admin')">Admin</button>
    <button id="systemTab" class="nav-item hidden" onclick="showSection('system')">System</button>

    <div style="margin-left:auto">
      <span id="welcomeName"></span>
      <button class="nav-item" onclick="logout()">Logout</button>
    </div>
  </nav>

  <section id="dashboard" class="section active">
    <h3>Dashboard</h3>
    Welcome to Rack Café Utd
  </section>

  <section id="players" class="section">
    <h3>Squad</h3>
    <div id="playersList"></div>
  </section>

  <section id="admin" class="section">
    <h3>Admin Panel</h3>
  </section>

  <section id="system" class="section">
    <h3>System Creator Panel</h3>
  </section>

</div>

<!-- ================= SCRIPT (INLINE ONLY) ================= -->
<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyAiRXtpn52GM2Rqi-FpdXvWxBjebAjd6_I",
  authDomain: "rackcafepool.firebaseapp.com",
  databaseURL: "https://rackcafepool-default-rtdb.firebaseio.com",
  projectId: "rackcafepool"
});

const auth = firebase.auth();
const db = firebase.database();

/* NAV */
window.showSection = function(id) {
  document.querySelectorAll(".section").forEach(s => {
    s.classList.remove("active");
  });

  document.getElementById(id).classList.add("active");

  document.querySelectorAll(".nav-item").forEach(b => b.classList.remove("active"));
};

/* LOGIN */
window.login = function() {
  const email = loginEmail.value.trim();
  const password = loginPassword.value;
  loginError.style.display = "none";

  if (!email || !password) {
    loginError.textContent = "Email and password required";
    loginError.style.display = "block";
    return;
  }

  auth.signInWithEmailAndPassword(email, password)
    .catch(err => {
      loginError.textContent = err.message;
      loginError.style.display = "block";
    });
};

/* LOGOUT */
window.logout = function() {
  auth.signOut().then(() => location.reload());
};

/* AUTH STATE */
auth.onAuthStateChanged(async user => {
  if (!user) return;

  loginScreen.classList.add("hidden");
  appContainer.classList.remove("hidden");

  const name = user.email.split("@")[0];
  welcomeName.textContent = name;

  const ref = db.ref("users/" + user.uid);
  const snap = await ref.get();

  if (!snap.exists()) {
    await ref.set({
      email: user.email,
      name,
      role: user.email === "thayessmith@rackcafeutd.com"
        ? "system-creator"
        : "player"
    });
  }

  const profile = (await ref.get()).val();

  if (["captain","co-captain","system-creator"].includes(profile.role)) {
    adminTab.classList.remove("hidden");
  }

  if (profile.role === "system-creator") {
    systemTab.classList.remove("hidden");
  }

  db.ref("users").on("value", snap => {
    playersList.innerHTML = "";
    Object.values(snap.val() || {}).forEach(u => {
      const div = document.createElement("div");
      div.textContent = `${u.name} (${u.role})`;
      playersList.appendChild(div);
    });
  });
});
</script>

</body>
</html>
